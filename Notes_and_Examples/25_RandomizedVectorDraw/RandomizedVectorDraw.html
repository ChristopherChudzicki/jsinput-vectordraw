<!DOCTYPE html>
<html>
    <head>
        <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
        <link href="vectordraw.css" rel="stylesheet" type="text/css" />
        <script src="//cdnjs.cloudflare.com/ajax/libs/seedrandom/2.4.0/seedrandom.min.js">
        </script>
    </head>

    <body>
        <div id="vectordraw" />
        <script type="text/javascript">
        //$_GET was copied from Lucas. I'm not sure if he wrote it or found it.
        function $_GET(v){return decodeURI(window.location.search.replace(new RegExp("^(?:.*[&\\?]" + encodeURI(v).replace(/[\.\+\*]/g, "\\$&") + "(?:\\=([^&]*))?)?.*$", "i"), "$1"));}
        var seed = $_GET("seed")
        Math.seedrandom(seed);
        
        Array.prototype.vectorAdd = function(other) {
            var result = []
            for(var i = 0; i < this.length; i++) {
                result.push( this[i] + other[i])
            }
            return result
        }
        Array.prototype.vectorMag = function() {
            var result = 0
            for(var i = 0; i < this.length; i++) {
                result += this[i]*this[i]
            }
            return Math.sqrt(result)
        }
        Array.prototype.vectorAngle = function() {
            var result = (this.length !== 2) ? undefined : Math.atan2(this[1],this[0])*180/Math.PI;
            return result
        }
		randomInteger = function(min,max){
		    return Math.floor((Math.random()*(max-min)) + min);
		}
		randomFloat = function(min,max){
		    return (Math.random()*(max-min)) + min;
		}
        polarToRect = function(mag,angle){
            return [mag*Math.cos(angle*Math.PI/180),mag*Math.sin(angle*Math.PI/180)]
        }
        
        //Get two random vectors
        var magA = randomInteger(3,6),
            angleA = randomInteger(0,360),
            magB = randomInteger(3,6),
            angleB = angleA + randomInteger(20,340);

        //Avoid vectors that are almost exactly opposite
        while (Math.abs(magA-magB) < 1 && Math.abs(angleA-angleB) < 40){
            magB = randomInteger(3,6);
        }
    
        var vecA = polarToRect(magA,angleA)
            vecB = polarToRect(magB,angleB),
            tailA = [randomFloat(-4,4) - vecA[0],randomFloat(-4,4) - vecA[1] ],
            tailB = [randomFloat(-4,4) - vecB[0],randomFloat(-4,4) - vecB[1] ];
        
        //Calculate C=A+B vector magnitude and angle
        var vecC = vecA.vectorAdd(vecB),
            magC = vecC.vectorMag(),
            angleC = vecC.vectorAngle();
        
        updateBoard = function (brd){
        
            JXG.Board.prototype.createVector = function(shape,settings){
                //This function draws vector that can be translated but not scaled or rotated.
                // shape={tail:[x,y],magnitude:float,angle:degrees}
                defaultSettings = {
                    strokeWidth:4,
                    label:{fontSize:18},
                }
                var settings = (settings===undefined) ? settings = defaultSettings : settings = _.extend(defaultSettings, settings)
                //Calculate rectangular coordinates of tip
                shape.angle = shape.angle*Math.PI/180;
                shape.tip = [shape.tail[0]+shape.magnitude*Math.cos(shape.angle),shape.tail[1]+shape.magnitude*Math.sin(shape.angle)]
                //Draw vector
                var vec = this.create('arrow',[shape.tail,shape.tip],settings);
                var vecPhantomLabel = brd.create('point',[function(){return vec.point2.X()},function(){return vec.point2.Y()}],{name:vec.name,label:{fontSize:settings.label.fontSize},fillOpacity:0,strokeOpacity:0,highlightFillOpacity:0,highlightStrokeOpacity:0,showInfobox:false})

                return vec
    		}
        
            var A = brd.createVector({tail:tailA,magnitude:magA,angle:angleA},{color:'blue',name:'A'});
            var B = brd.createVector({tail:tailB,magnitude:magB,angle:angleB},{color:'red',name:'B'});
        }
        
        
        
        // Background image, vectors, and points are defined below.
        var vectordraw_settings = {
            width: 550,
            height: 450,
            bounding_box_size: 8,
            background: {
                src: '',
                width: 20
            },
            drawOnBoard:updateBoard,
            vectors: [
                {
                    name: 'A+B', description: 'Vector A+B', coords: [[2, 2], [7, 8]], render: false,style:{color:'purple'}
                },
            ],
            expected_result: {
                'A+B': {angle: angleC, angle_tolerance: 4,length:magC,length_tol:0.05*magC},
            }
        };
        </script>

        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.2/underscore-min.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jsxgraph/0.98/jsxgraphcore.js"></script>
        <script type="text/javascript" src="vectordraw.js"></script>
    </body>
</html>
